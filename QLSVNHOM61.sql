CREATE DATABASE QLSV_NHOM6
GO

USE QLSV_NHOM6
GO
CREATE TABLE TAIKHOAN
(
	MaTk CHAR(10) PRIMARY KEY,
	TaiKhoan VARCHAR(20) NOT NULL UNIQUE,
	MatKhau VARCHAR(8) NOT NULL UNIQUE,
	PhanLoai NVARCHAR(20) NOT NULL
)
CREATE TABLE CHUONGTRINH
(
		MaChuongTrinh CHAR(10) PRIMARY KEY,
		TenChuongTrinh NVARCHAR(50) NOT NULL,
)
CREATE TABLE KHOAHOC
(
		MaKhoaHoc CHAR(10) PRIMARY KEY,
		TenKhoaHoc NVARCHAR(50) NOT NULL,
		NamBatDau Date NOT NULL,
		NamKetThuc Date NOT NULL,
		MaChuongTrinh CHAR(10),
		FOREIGN KEY(MaChuongTrinh) REFERENCES CHUONGTRINH(MaChuongTrinh)
)
CREATE TABLE KHOA
(
	MaKhoa CHAR(10) PRIMARY KEY,
	TenKhoa NVARCHAR(50) NOT NULL UNIQUE
)
 GO
CREATE TABLE LOP 
(
		MaLop CHAR(10) PRIMARY KEY,
		TenLop NVARCHAR(50) NOT NULL UNIQUE,
		MaKhoa VARCHAR(20) NOT NULL,
		SoSV TINYINT,
		MaKhoaHoc CHAR(10) NOT NULL UNIQUE,
		FOREIGN KEY(MaKhoa) REFERENCES KHOA(MaKhoa)
		FOREIGN KEY(MaKhoaHoc) REFERENCES KHOAHOC(MaKhoaHoc)
)
GO

CREATE TABLE LICHDAY
(
	MaGV VARCHAR(20) NOT NULL,
	MaLop VARCHAR(20) NOT NULL,
	MaMon VARCHAR(20) NOT NULL,
	NgayDay DATE,
	SoTietDay TINYINT,
	CaDay BIT,
	GhiChu NVARCHAR(50),
	PRIMARY KEY(MaGV,MaLop,MaMon,NgayDay),
	FOREIGN KEY(MaMon) REFERENCES MON(MaMon),
	FOREIGN KEY(MaLop) REFERENCES LOP(MaLop),
	FOREIGN KEY(MaGV) REFERENCES GIAOVIEN(MaGV)
)
CREATE TABLE SINHVIEN
(
	MaSV CHAR(10) PRIMARY KEY,
	AnhDaiDien IMAGE,
	CMND CHAR(10) UNIQUE,
	TenSV NVARCHAR(50) NOT NULL,
	NgaySinh DATE NOT NULL,
	GioiTinh BIT NOT NULL,
	DanToc NVARCHAR(10),
	TonGiao NVARCHAR(10),
	DiaChi NVARCHAR(50),
	QueQuan NVARCHAR(50),
	SDT VARCHAR(10) UNIQUE,
	NgayNhapHoc DATE,
	MaKhoaHoc CHAR(10) NOT NULL,
	MaLop VARCHAR(20) NOT NULL,
	MaTk VARCHAR(20) NOT NULL,
	FOREIGN KEY(MaLop) REFERENCES LOP(MaLop),
	FOREIGN KEY(MaTk) REFERENCES TAIKHOAN(MaTk)
)

CREATE TABLE GIAOVIEN
(
	MaGV VARCHAR(20) PRIMARY KEY,
	AnhDaiDien IMAGE,
	TenGV NVARCHAR(50) NOT NULL,
	NgaySinh DATE,
	GioiTinh BIT NOT NULL,
	SDT VARCHAR(10) UNIQUE,
	DiaChi NVARCHAR(50),
	QueQuan NVARCHAR(50) NOT NULL,
	DanToc NVARCHAR(10),
	TonGiao NVARCHAR(10),
	MaKhoa VARCHAR(20) NOT NULL,
	MaTk VARCHAR(20) NOT NULL,
	FOREIGN KEY(MaTk) REFERENCES TAIKHOAN(MaTk),
	FOREIGN KEY(MaKhoa) REFERENCES KHOA(MaKhoa)

)
CREATE TABLE MON
(
		MaMon VARCHAR(20) PRIMARY KEY,
		TenMon NVARCHAR(50) NOT NULL UNIQUE,		
		SoTiet TINYINT NOT NULL,
		SoTinChi TINYINT NOT NULL
		
)
CREATE TABLE DIEM
(
	MaSV VARCHAR(20) NOT NULL,
	MaMon VARCHAR(20) NOT NULL,
	DiemTX FLOAT  DEFAULT 0,
	DiemKT1 FLOAT DEFAULT 0,
	DiemKT2 FLOAT DEFAULT 0,
	DiemThi FLOAT DEFAULT 0,
	LanThi TINYINT, 
	DiemTB FLOAT  DEFAULT 0,
	TrangThai NVARCHAR(20) NOT NULL,
	GhiChu NVARCHAR(50),
	PRIMARY KEY(MaSV,MaMon),
	FOREIGN KEY(MaSV) REFERENCES SINHVIEN(MaSV),
	FOREIGN KEY(MaMon) REFERENCES MON(MaMon)

)
CREATE TABLE PHANCONG
(
	MaGV VARCHAR(20) NOT NULL,
	MaLop VARCHAR(20) NOT NULL,
	MaMon VARCHAR(20) NOT NULL,
	ViTri VARCHAR(20) NOT NULL,
	HocKi TINYINT NOT NULL,
	NamHoc DATE NOT NULL,
	GhiChu NVARCHAR(50),
	PRIMARY KEY(MaGV,MaLop,MaMon),
	FOREIGN KEY(MaMon) REFERENCES MON(MaMon),
	FOREIGN KEY(MaLop) REFERENCES LOP(MaLop),
	FOREIGN KEY(MaGV) REFERENCES GIAOVIEN(MaGV)
)

CREATE TABLE DIEMDANH
(
	MaSV VARCHAR(50) NOT NULL,
    NgayDiemDanh DATE NOT NULL,
    DiemDanh INT NOT NULL,
	GhiChu NVARCHAR(50),
	PRIMARY KEY(MaSV,NgayDiemDanh)
)
CREATE TABLE HOCPHI
(
MaSV VARCHAR(20) NOT NULL,
TienHoc INT,
TienGiamHocPhi INT,
TrangThai BIT NOT NULL,
)
CREATE TABLE LUONGGIAOVIEN
(
)
CREATE INDEX KHOA_INDEX
ON KHOA(MaKhoa)
GO

CREATE INDEX LOP_INDEX
ON LOP(MaKhoa,MaLop)
GO

CREATE INDEX SINHVIEN_INDEX
ON SINHVIEN(MaSV,MaLop)
GO

CREATE INDEX GIAOVIEN_INDEX
ON GIAOVIEN(QueQuan,MaGV)
GO
CREATE INDEX DIEM_INDEX
ON DIEM(MaMon,MaSV)
GO